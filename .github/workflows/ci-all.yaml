name: CI - Complete Test Suite

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:  # Permet de lancer manuellement

jobs:
  backend:
    name: Run Backend CI
    uses: ./.github/workflows/ci-backend.yaml

  frontend:
    name: Run Frontend CI
    uses: ./.github/workflows/ci-frontend.yaml

  e2e:
    needs: [backend, frontend]
    name: Run E2E Tests
    uses: ./.github/workflows/ci-e2e.yaml

  docker:
    if: github.ref == 'refs/heads/main'
    needs: [e2e]
    uses: ./.github/workflows/ci-docker.yaml
    secrets: inherit
   
  storybook:
    needs: [e2e, docker]
    name: Run Storybook CI
    uses: ./.github/workflows/ci-storybook.yaml

  cd:
    if: github.ref == 'refs/heads/main'
    needs: [docker]
    uses: ./.github/workflows/cd.yaml
    secrets: inherit